---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

# contactparser

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```


<!-- badges: start -->
```{r current-branch-badge, results = "asis", echo = FALSE, warning = FALSE}
.get_badge_string <- function(branch) {
  travis_url <- "https://travis-ci.org/UW-GAC/contactparser"
  paste0(
    sprintf("[![Travis build status](%s.svg?branch=%s)]", travis_url, branch),
    sprintf("(%s)", travis_url)
  )
}

current_branch <- system("git rev-parse --abbrev-ref HEAD", intern = TRUE)
df <- data.frame(
  branch = union("master", current_branch)
)

df$badges <- sapply(df$branch, .get_badge_string)
df$branch <- sprintf("**%s**", df$branch)
names(df) <- c("Branch", "Build status")
df %>% 
  knitr::kable(format = "markdown")
```

<!-- badges: end -->

## Description

The contactparser package was designed to parse and reformat the [Contacts table](https://www.nhlbiwgs.org/contact-filter) on the TOPMed website.


## Installation

You can install the released version of contactparser from [github](https://github.com/UW-GAC/contactparser) with:

``` r
# install.packages("devtools") 
devtools::install_github("UW-GAC/contactparser")
```

## Example

This package has one primary function to read, parse, and reformat the contacts table.
It starts with either a csv file or an html file, parses it, and reshapes the table so that it can easily be filtered by TOPMed study, project, or contact type (PI, Co-PI, Contact, etc.).

First, export the table to a csv file with the "export" button.
Then call:
```{r csv-example}
library(contactparser)
csv_file <- system.file(package = "contactparser", "testdata", "example.csv")
parsed <- parse_contact_table(csv_file)
parsed
```

You can also save the webpage as an html file and parse the contact table from the html:
```{r html-example}
library(contactparser)
html_file <- system.file(package = "contactparser", "testdata", "example.html")
parsed <- parse_contact_table(html_file)
parsed
```

Once you've parsed the file, you can easily filter to specific types of contacts using `dplyr` functions:
```{r filter-example}
library(dplyr, quietly = TRUE)

# Just PIs:
pis <- parsed %>%
  filter(contact_type %in% c("pi", "co_pi"))
pis
```

Then you can create a string of emails that you can cut and paste into your email client:
```{r email-example}
unique_pi_emails <- unique(pis$email)
cat(paste(unique_pi_emails, collapse = ", "))
```
